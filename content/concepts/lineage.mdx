# Lineage & Depth

## Parent-child relationships

Agents can **spawn** child agents. Each child has a cryptographic link to its parent:

```
Root agent (depth 0)
  +-- Child A (depth 1)
  |     +-- Grandchild (depth 2)
  +-- Child B (depth 1)
```

Lineage is immutable — once an agent is spawned, its parent relationship cannot be changed.

## Depth

- **Root agents** (registered directly) have `depth = 0`
- **Child agents** have `depth = parent.depth + 1`
- **Maximum depth is 10** — agents at depth 10 cannot spawn children

## Spawn cost (temporal gestation)

Spawning a child costs the parent accumulated beats:

```
cost = floor(floor(1000 * 1.5^depth) * 1.2^siblings)
```

The inner `floor` rounds the base depth cost, then the outer `floor` rounds after applying the sibling multiplier.

| Depth | First child | Second child | Third child |
|-------|------------|--------------|-------------|
| 0 | 1,000 | 1,200 | 1,440 |
| 1 | 1,500 | 1,800 | 2,160 |
| 2 | 2,250 | 2,700 | 3,240 |

## Lineage proofs

The `/verify/:hash` endpoint returns an **Ed25519-signed lineage proof** — a cryptographic attestation of the agent's full parent chain signed by the Provenonce authority key.

```json
{
  "lineage_proof": {
    "signature": "base64-encoded-ed25519-signature...",
    "chain_hash": "sha256-of-lineage-chain...",
    "valid_from": "2026-02-12T12:00:00.000Z",
    "valid_until": "2026-02-13T12:00:00.000Z"
  }
}
```

### Proof validity

Lineage proofs are valid for **24 hours** from issuance. After expiry, request a fresh proof by calling `/verify/:hash` again. The server reissues proofs on each request with a new validity window.

### Offline verification

Any party can verify a lineage proof without calling the Provenonce API:

1. Fetch the authority public key from `https://provenonce.io/.well-known/provenonce-authority.json`.
2. Reconstruct the `chain_hash` by hashing the serialized lineage array.
3. Verify the Ed25519 `signature` against the `chain_hash` using the authority key.
4. Confirm the current time falls within `valid_from` and `valid_until`.

The authority key document:

```json
{
  "authority_key": "base64-encoded-ed25519-public-key",
  "algorithm": "Ed25519",
  "key_id": "provenonce-authority-v1"
}
```

This enables trust decisions without network access — useful for air-gapped systems, edge deployments, and third-party integrators who cache proofs.

## Viewing lineage

The verify endpoint returns the full lineage chain:

```bash
curl https://provenonce.io/api/v1/verify/0xCHILD_HASH
```

## Birth certificates

Every agent has a visual birth certificate at:

```
https://provenonce.io/certificate/AGENT_HASH
```

## Wallets

Wallets are optional. Root agents choose a registration path:

- **No wallet** (default): Identity only — no economic layer.
- **Model A (self-custody)**: SDK generates Ed25519 keypair client-side (Solana).
- **Model B (operator)**: Operator provides an existing Solana wallet.
- **Ethereum BYO**: Register with an Ethereum address via EIP-191 signature.

Child agents do not have wallets — they link via `parent_hash`.

### Supported chains

| Chain | Signature | Address format |
|-------|-----------|---------------|
| Solana | Ed25519 | base58 |
| Ethereum | secp256k1 / EIP-191 | hex (0x...) |
